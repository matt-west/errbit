- content_for :title, @app.name
- content_for :head do
  = auto_discovery_link_tag :atom, app_path(@app, User.token_authentication_key => current_user.authentication_token, :format => "atom"), :title => "Errbit notices for #{@app.name} at #{request.host}"
- content_for :meta do
  %strong Errors Caught:
  = @app.problems.count
  %strong Deploy Count:
  = @app.deploys.count
  %strong API Key:
  = @app.api_key
- content_for :action_bar do
  .btn-toolbar
    .btn-group
      - if current_user.admin?
        %a{ :class => 'btn btn-primary', :href => edit_app_path(@app) }
          %i{ :class => 'icon-edit icon-white' }
          Edit
        %a{ :class => 'btn btn-danger', :href => '#delete-confirm', :data => { :toggle => 'modal', :id => @app.id } }
          %i{ :class => 'icon-trash icon-white' }
          Delete
      - if @all_errs
        %a{ :class => 'btn btn-inverse', :href => app_path(@app) }
          %i{ :class => 'icon-eye-open icon-white' }
          Show Only Unresolved Errors
      - else
        %a{ :class => 'btn btn-info', :href => app_path(@app, :all_errs => true) }
          %i{ :class => 'icon-fire icon-white' }
          Show All Errors
    %a{ :class => 'btn btn-inverse pull-right', :href => apps_path }
      %i{ :class => 'icon-chevron-left icon-white'}
      Back To Apps

.well
  .row
    %h3#watchers_toggle.span2
      Watchers
    %div.span2
      %div{ :class => 'toggle basic watchers', :data => { :enabled => 'Hide', :disabled => 'Show', :toggle => 'toggle' } }
        %input{ :type => 'checkbox', :value => 1, :name => 'toggle-watchers', :class => 'checkbox'}
        %label{ :class => 'check', :for => 'toggle-watchers'}

  #watchers_div
    - if @app.notify_all_users
      %table.watchers
        %thead
          %tr
            %th All users will be notified when something happens.
    - else
      %table.watchers.table.table-striped
        %thead
          %tr
            %th User or Email
        %tbody
          - @app.watchers.each do |watcher|
            %tr
              %td= watcher.label
          - if @app.watchers.none?
            %tr
              %td
                %em Sadly, no one is watching this app


- if @app.github_repo?
  .well
    .row
      %h3#repository_toggle.span2
        Repository
      %div.span2
        %div{ :class => 'toggle basic repository', :data => { :enabled => 'Hide', :disabled => 'Show', :toggle => 'toggle' } }
          %input{ :type => 'checkbox', :value => 1, :name => 'toggle-repository', :class => 'checkbox'}
          %label{ :class => 'check', :for => 'toggle-repository'}

    #repository_div
      %table.repository.table.table-striped
        %thead
          %tr
            %th GitHub Repo
        %tbody
          %tr
            %td= link_to(@app.github_repo, @app.github_url, :target => '_blank')

.well
  %div.row
    %h3#deploys_toggle.span2
      Latest Deploys
    %div.span2
      %div{ :class => 'toggle basic deploys', :data => { :enabled => 'Hide', :disabled => 'Show', :toggle => 'toggle' } }
        %input{ :type => 'checkbox', :value => 1, :name => 'toggle-deploys', :class => 'checkbox'}
        %label{ :class => 'check', :for => 'toggle-deploys'}

  #deploys_div
    - if @deploys.any?
      %table.deploys.table.table-striped
        %thead
          %tr
            %th When
            %th Environment
            %th Who
            %th Message
            %th Repository
            %th Revision

        %tbody
          - @deploys.each do |deploy|
            %tr
              %td.when #{deploy.created_at.to_s(:micro)}
              %td.environment #{deploy.environment}
              %td.who #{deploy.username}
              %td.message #{deploy.message}
              %td.repository #{deploy.repository}
              %td.revision #{deploy.short_revision}
      = link_to "All Deploys (#{@app.deploys.count})", app_deploys_path(@app), :class => 'button'
    - else
      %h3 No deploys

- if @app.problems.any?
  %h3.clear Errors
  = render 'errs/table', :errs => @problems
- else
  %h3.clear.alert.alert-info No errs have been caught yet, make sure you setup your app
  = render 'configuration_instructions', :app => @app


%div.modal.fade#delete-confirm
  .modal-header
    %a{ :class => 'close', :data => { :dismiss => 'modal' } }
    %h2= "Delete #{@app.name}"
  .modal-body
    %p= "Are you sure you wish to delete #{@app.name}?"
  .modal-footer
    =link_to 'Delete', app_path(@app), :method => :delete, :class => 'button btn btn-danger'
    %a{ :href => '#', :class => 'btn btn-primary', :data => { :dismiss => 'modal' } } Cancel