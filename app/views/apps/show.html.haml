- content_for :title, @app.name
- content_for :head do
  = auto_discovery_link_tag :atom, app_path(@app, User.token_authentication_key => current_user.authentication_token, :format => "atom"), :title => "Errbit notices for #{@app.name} at #{request.host}"
- content_for :meta do
  %strong Errors Caught:
  = @app.problems.count
  %strong Deploy Count:
  = @app.deploys.count
  %strong API Key:
  = @app.api_key
- content_for :action_bar do
  .btn-toolbar
    .btn-group
      - if current_user.admin?
        %a{ :class => 'btn btn-primary', :href => edit_app_path(@app) }
          %i{ :class => 'icon-edit icon-white' }
          Edit
        %a{ :class => 'btn btn-danger', :href => '#delete-confirm', :data => { :toggle => 'modal', :id => @app.id } }
          %i{ :class => 'icon-trash icon-white' }
          Delete
      - if @all_errs
        %a{ :class => 'btn btn-inverse', :href => app_path(@app) }
          %i{ :class => 'icon-eye-close icon-white' }
          Show Only Unresolved Errors
      - else
        %a{ :class => 'btn btn-info', :href => app_path(@app, :all_errs => true) }
          %i{ :class => 'icon-eye-open icon-white' }
          Show All Errors
    %a{ :class => 'btn btn-inverse pull-right', :href => apps_path }
      %i{ :class => 'icon-chevron-left icon-white'}
      Back To Apps

  .row
    .span10
      - if @app.problems.any?
        %h3.clear Errors
        = render 'errs/table', :errs => @problems
      - else
        %h3.clear.alert.alert-info No errs have been caught yet, make sure you setup your app
        = render 'configuration_instructions', :app => @app

      %h3.clear Latest Deploys
      #deploys
        %table.deploys.table.table-striped.table-bordered
          %thead
            %tr
              %th When
              %th Environment
              %th Who
              %th Message
              %th Repository
              %th Revision

          - if @deploys.any?
            %tbody
              - @deploys.each do |deploy|
                %tr
                  %td.when #{deploy.created_at.to_s(:micro)}
                  %td.environment #{deploy.environment}
                  %td.who #{deploy.username}
                  %td.message #{deploy.message}
                  %td.repository #{deploy.repository}
                  %td.revision #{deploy.short_revision}
          - else
            %tbody
              %tr
                %td{ :colspan => 6}
                  %p No deploys

        =link_to "All Deploys (#{@app.deploys.count})", app_deploys_path(@app), :class => 'button btn btn-primary'


    .span2
      .well
        %h3 Watchers
        #watchers
          - if @app.notify_all_users
            %p All users will be notified when something happens.
          - else
            %ul
            - @app.watchers.each do |watcher|
              %li= watcher.label
            - if @app.watchers.none?
              %p
                %em Sadly, no one is watching this app


      - if @app.github_repo?
        .well
          %h3 Repository
          #repository
            = link_to(@app.github_repo, @app.github_url, :target => '_blank')


%div.modal.fade#delete-confirm
  .modal-header
    %a{ :class => 'close', :data => { :dismiss => 'modal' } }
    %h2= "Delete #{@app.name}"
  .modal-body
    %p= "Are you sure you wish to delete #{@app.name}?"
  .modal-footer
    =link_to 'Delete', app_path(@app), :method => :delete, :class => 'button btn btn-danger'
    %a{ :href => '#', :class => 'btn btn-primary', :data => { :dismiss => 'modal' } } Cancel